<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Ruby 3.1.0 リリース</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/ja/news/2021/12/25/ruby-3-1-0-released/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/ja/feeds/news.rss" rel="alternate" title="最近のニュース (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/ja/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/ja/" class="home">Home</a>

  <a href="/ja/downloads/">ダウンロード</a>

  <a href="/ja/documentation/">ドキュメント</a>

  <a href="/ja/libraries/">ライブラリ</a>

  <a href="/ja/community/">コミュニティ</a>

  <a href="/ja/dev/">コア開発</a>

  <a href="/ja/news/">ニュース</a>

  <a href="/ja/security/">セキュリティ</a>

  <a href="/ja/about/">Rubyとは</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/ja/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/ja/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="008288045305770251182:fvruzsaknew" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="検索" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Ruby 3.1.0 リリース</h1>



  <div id="content">
    <p class="post-info">Posted by naruse on 25 Dec 2021</p>

    <p>Ruby 3.1系初のリリースである、Ruby 3.1.0 が公開されました。Ruby 3.1は3.0と高い互換性を保ちながら、多くの機能を追加しています。</p>
<h2>YJIT: New experimental in-process JIT compiler</h2>
<p>Ruby 3.1では、Shopifyが開発した新しいプロセス内JITコンパイラであるYJITをマージしました。</p>
<p><a href="https://www.ruby-lang.org/ja/news/2018/12/25/ruby-2-6-0-released/">2018年のRuby 2.6でMJITをマージ</a>して以来、そのパフォーマンスは年々改善され、去年には<a href="https://www.ruby-lang.org/ja/news/2020/12/25/ruby-3-0-0-released/">Ruby3x3を無事達成</a>しました。比較的大規模なOptcarrotベンチマークでは輝かしい高速化を達成したMJITですが、一方で現実の業務アプリケーションの性能はこれまで改善出来ていませんでした。</p>
<p>近年Shopifyは彼らのRailsアプリケーションを高速化するため、Rubyに対して多くの貢献をしてきました。YJITはその中でも重要な貢献であり、Railsアプリケーションをさらに高速化するために開発されました。</p>
<p>MJITがメソッドベースのJITコンパイラであり、外部のCコンパイラを利用しているのに対し、YJITではBasic Block Versioningという技術を用いた独自のJITコンパイラをRuby内部に持っています。YJITの用いているLazy Basic Block Versioning (LBBC)では、まずメソッドの冒頭のみをコンパイルし、実行時に実際に値が渡されて引数や変数の値が明らかになってから残りをコンパイルするという手法を用いることで、動的プログラミング言語においても効率のよいJITを実現しています。詳細は <a href="https://dl.acm.org/doi/10.1145/3486606.3486781">YJIT: a basic block versioning JIT compiler for CRuby</a> を参照ください。</p>
<p>これらの技術によって、YJITでは素早い起動と高速な実行を多くの実世界のアプリケーションに対して実現しており、railsbenchでは最大22%、liquied-renderでは39%の高速化を達成しています。</p>
<p>YJITはまだ実験的機能なため、デフォルトでは無効化されています。試してみたい場合には <code>--yjit</code> コマンドラインオプションを指定することでYJITを有効化出来ます。現在YJITはx86-64上のUnix系プラットフォームでのみ実行出来ます。</p>
<ul>
<li><a href="https://bugs.ruby-lang.org/issues/18229">https://bugs.ruby-lang.org/issues/18229</a></li>
<li><a href="https://shopify.engineering/yjit-just-in-time-compiler-cruby">https://shopify.engineering/yjit-just-in-time-compiler-cruby</a></li>
<li><a href="https://www.youtube.com/watch?v=PBVLf3yfMs8">https://www.youtube.com/watch?v=PBVLf3yfMs8</a></li>
</ul>
<h2>debug gem: 新しいデバッガ</h2>
<p>完全に0から書き直したデバッガである <a href="https://github.com/ruby/debug">debug.gem</a> が同梱されました。次のような特徴があります。</p>
<ul>
<li>デバッグ時の速度低下を極力生じないよう改善</li>
<li>リモートデバッグのサポート</li>
<li>リッチなデバッガフロントエンドに対応（現在 VSCode と Chrome ブラウザに対応）</li>
<li>マルチプロセス、マルチスレッドプログラムのデバッグに対応</li>
<li>カラフルな REPL</li>
<li>そのほか、Record &amp; Replay 機能やトレース機能など、様々な便利機能</li>
</ul>
<!-- raw HTML omitted -->
<p>Rubyにはこれまでも lib/debug.rb が同梱されていましたが、あまりメンテナンスされておらず、性能や機能に問題がありました。debug.gem はこれを完全に置き換えます。</p>
<h2>error_highlight: バックトレース中の詳細なエラー位置表示</h2>
<p>error_highlightという組み込みgemが導入されました。これにより、バックトレース中でエラーが発生した詳細な位置が表示されます。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ruby test.rb
test.rb:1:in `&lt;main&gt;': undefined method `time' for 1:Integer (NoMethodError)

1.time {}
 ^^^^^
Did you mean?  times
</code></pre></div></div>
<p>現在のところ、位置が表示されるのは<code>NameError</code>のみです。</p>
<p>このgemはデフォルトで有効になっています。<code>--disable-error_highlight</code>コマンドラインオプションを指定することで無効化できます。詳しくは<a href="https://github.com/ruby/error_highlight">ruby/error_highlightリポジトリ</a>を見てください。</p>
<h2>IRB のオートコンプリートとドキュメント表示</h2>
<p>IRB にオートコンプリート機能が実装され、コードを入力するだけで補完候補ダイアログが表示されるようになりました。Tab と Shift+Tab で上下に移動できます。</p>
<p>また、補完候補を選択している時に、ドキュメントがインストールされている場合、補完候補ダイアログの横にドキュメントダイアログが表示され、内容が一部表示されます。Alt+d を押すことでドキュメント全文を読むことができます。</p>
<!-- raw HTML omitted -->
<h2>その他の主要な新機能</h2>
<h3>言語機能</h3>
<ul>
<li>
<p>ハッシュリテラルやキーワード引数の値が省略可能になりました。 <a href="https://bugs.ruby-lang.org/issues/14579">[Feature #14579]</a></p>
<ul>
<li><code>{x:, y:}</code> は、<code>{x: x, y: y}</code> の糖衣構文です。</li>
<li><code>foo(x:, y:)</code> は、<code>foo(x: x, y: y)</code> の糖衣構文です。</li>
</ul>
</li>
<li>
<p>パターンマッチ中のピン演算子に任意の式を書けるようになりました。 <a href="https://bugs.ruby-lang.org/issues/17411">[Feature #17411]</a></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="ruby"><span class="no">Prime</span><span class="p">.</span><span class="nf">each_cons</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">lazy</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="n">_1</span> <span class="k">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="o">^</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]}.</span><span class="nf">take</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">to_a</span>
<span class="c1">#=&gt; [[3, 5], [5, 7], [11, 13]]</span>
</code></pre></div></div>
</li>
<li>
<p>一行パターンマッチで括弧が省略できるようになりました. <a href="https://bugs.ruby-lang.org/issues/16182">[Feature #16182]</a></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span>
<span class="p">{</span><span class="ss">y: </span><span class="mi">2</span><span class="p">}</span> <span class="o">=&gt;</span> <span class="ss">y:
</span><span class="n">x</span> <span class="c1">#=&gt; 1</span>
<span class="n">y</span> <span class="c1">#=&gt; 2</span>
</code></pre></div></div>
</li>
</ul>
<h3>RBS</h3>
<p><a href="https://github.com/ruby/rbs">RBS</a>はRubyプログラムの型を定義するための言語です。</p>
<p>3.0.0からは、次の様なアップデートがありました。</p>
<ul>
<li>ジェネリクスの型パラメータに制約を与えることができるようになりました。 (<a href="https://github.com/ruby/rbs/pull/844">PR</a>)</li>
<li>ジェネリックな型エイリアスが定義できようになりました。 (<a href="https://github.com/ruby/rbs/pull/823">PR</a>)</li>
<li>gemのRBSを管理するための<code>rbs collection</code>コマンドが導入されました。 (<a href="https://github.com/ruby/rbs/blob/master/docs/collection.md">doc</a>)</li>
<li>いろいろな組み込みクラスの型定義が追加、更新されました。</li>
<li>多数のバグ修正と性能の改善が含まれています。</li>
</ul>
<p>詳しくは<a href="https://github.com/ruby/rbs/blob/master/CHANGELOG.md">CHANGELOG.md</a>を確認してください。</p>
<h3>TypeProf</h3>
<p>TypeProfはRubyの静的型解析器です。型注釈のないRubyコードから、RBSのプロトタイプを生成します。詳しくは<a href="https://github.com/ruby/typeprof/blob/master/doc/doc.md">ドキュメント</a>をご参照ください.</p>
<p>Ruby 3.0.0からの主なアップデートは、&quot;TypeProf for IDE&quot;という実験的なIDEサポートです。</p>
<p><img src="https://cache.ruby-lang.org/pub/media/ruby310_typeprof_ide_demo.png" alt="Demo of TypeProf for IDE" /></p>
<p>このVSCode拡張は、推定された（またはRBSファイルに手で明記された）メソッドのシグネチャを、各メソッド定義の上に表示します。
また、NameErrorやTypeErrorを起こしうるコードを赤い下線で示します。
さらに、メソッド名の補完（メソッド名の候補の表示）を行います。
詳しくは<a href="https://github.com/ruby/typeprof/blob/master/doc/ide.md">ドキュメント</a>をご参照ください。</p>
<p>また、数多くのバグ修正やパフォーマンス向上がなされています。</p>
<h2>パフォーマンスの改善</h2>
<ul>
<li>MJIT
<ul>
<li>For workloads like Rails, the default <code>--jit-max-cache</code> is changed from 100 to 10000.
The JIT compiler no longer skips compilation of methods longer than 1000 instructions.</li>
<li>To support Zeitwerk of Rails, JIT-ed code is no longer cancelled
when a TracePoint for class events is enabled.</li>
</ul>
</li>
</ul>
<h2>その他の注目すべき 3.0 からの変更点</h2>
<ul>
<li>
<p>一行パターンマッチ（たとえば <code>ary =&gt; [x, y, z]</code>）が実験的機能ではなくなりました。</p>
</li>
<li>
<p>多重代入の評価順序が若干変更されました。<a href="https://bugs.ruby-lang.org/issues/4443">[Bug #4443]</a></p>
<ul>
<li><code>foo[0], bar[0] = baz, qux</code> は、Ruby 3.0 では <code>baz</code>, <code>qux</code>, <code>foo</code>, <code>bar</code> という順序で評価されていましたが、Ruby 3.1 では <code>foo</code>, <code>bar</code>, <code>baz</code>, <code>qux</code> の順で評価されます。</li>
</ul>
</li>
<li>
<p>可変幅アロケーション（Variable Width Allocation）が実装されました。現在は試験的にStringが対応しています。 <a href="https://bugs.ruby-lang.org/issues/18239">[Bug #18239]</a></p>
</li>
<li>
<p>Psych 4.0 では <code>Psych.load</code> が <code>safe_load</code> を利用するように変更されました。この挙動が影響ある場合は、従来の挙動である <code>unsafe_load</code> を利用する Psych 3.3.2 を移行パスとして利用できます。<a href="https://bugs.ruby-lang.org/issues/17866">[Bug #17866]</a></p>
</li>
</ul>
<h2>標準添付ライブラリのアップデート</h2>
<ul>
<li>以下の default gems のバージョンがアップデートされました。
<ul>
<li>RubyGems 3.3.3</li>
<li>base64 0.1.1</li>
<li>benchmark 0.2.0</li>
<li>bigdecimal 3.1.1</li>
<li>bundler 2.3.3</li>
<li>cgi 0.3.1</li>
<li>csv 3.2.2</li>
<li>date 3.2.2</li>
<li>did_you_mean 1.6.1</li>
<li>digest 3.1.0</li>
<li>drb 2.1.0</li>
<li>erb 2.2.3</li>
<li>error_highlight 0.3.0</li>
<li>etc 1.3.0</li>
<li>fcntl 1.0.1</li>
<li>fiddle 1.1.0</li>
<li>fileutils 1.6.0</li>
<li>find 0.1.1</li>
<li>io-console 0.5.10</li>
<li>io-wait 0.2.1</li>
<li>ipaddr 1.2.3</li>
<li>irb 1.4.1</li>
<li>json 2.6.1</li>
<li>logger 1.5.0</li>
<li>net-http 0.2.0</li>
<li>net-protocol 0.1.2</li>
<li>nkf 0.1.1</li>
<li>open-uri 0.2.0</li>
<li>openssl 3.0.0</li>
<li>optparse 0.2.0</li>
<li>ostruct 0.5.2</li>
<li>pathname 0.2.0</li>
<li>pp 0.3.0</li>
<li>prettyprint 0.1.1</li>
<li>psych 4.0.3</li>
<li>racc 1.6.0</li>
<li>rdoc 6.4.0</li>
<li>readline 0.0.3</li>
<li>readline-ext 0.1.4</li>
<li>reline 0.3.0</li>
<li>resolv 0.2.1</li>
<li>rinda 0.1.1</li>
<li>ruby2_keywords 0.0.5</li>
<li>securerandom 0.1.1</li>
<li>set 1.0.2</li>
<li>stringio 3.0.1</li>
<li>strscan 3.0.1</li>
<li>tempfile 0.1.2</li>
<li>time 0.2.0</li>
<li>timeout 0.2.0</li>
<li>tmpdir 0.1.2</li>
<li>un 0.2.0</li>
<li>uri 0.11.0</li>
<li>yaml 0.2.0</li>
<li>zlib 2.1.1</li>
</ul>
</li>
<li>以下の bundled gems のバージョンがアップデートされました。
<ul>
<li>minitest 5.15.0</li>
<li>power_assert 2.0.1</li>
<li>rake 13.0.6</li>
<li>test-unit 3.5.3</li>
<li>rexml 3.2.5</li>
<li>rbs 2.0.0</li>
<li>typeprof 0.21.1</li>
</ul>
</li>
<li>以下のライブラリが新たに bundled gems になりました。Bundler から利用する場合は Gemfile に明示的に指定してください。
<ul>
<li>net-ftp 0.1.3</li>
<li>net-imap 0.2.2</li>
<li>net-pop 0.1.1</li>
<li>net-smtp 0.3.1</li>
<li>matrix 0.4.2</li>
<li>prime 0.1.2</li>
<li>debug 1.4.0</li>
</ul>
</li>
</ul>
<p>その他詳細については、<a href="https://github.com/ruby/ruby/blob/v3_1_0/NEWS.md">NEWS</a> ファイルまたは<a href="https://github.com/ruby/ruby/compare/v3_0_0...v3_1_0">コミットログ</a>を参照してください。</p>
<p>なお、こうした変更により、Ruby 3.0.0 以降では <a href="https://github.com/ruby/ruby/compare/v3_0_0...v3_1_0#file_bucket">3124 個のファイルに変更が加えられ、551760 行の追加と 99167 行の削除が行われました</a> !</p>
<p>メリークリスマス、様々な機能が追加された Ruby 3.1 をぜひお楽しみ下さい！</p>
<h2>ダウンロード</h2>
<ul>
<li>
<p><a href="https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0.tar.gz">https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0.tar.gz</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIZE: 20103517
SHA1: e4e8c20dd2a1fdef4d3e5bd5a3461000dd17f226
SHA256: 50a0504c6edcb4d61ce6b8cfdbddaa95707195fab0ecd7b5e92654b2a9412854
SHA512: 76009d325e961e601d9a287e36490cbc1f3b5dbf4878fa6eab2c4daa5ff2fed78cbc7525cd87b09828f97cbe2beb30f528928bcc5647af745d03dffe7c5baaa9
</code></pre></div></div>
</li>
<li>
<p><a href="https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0.tar.xz">https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0.tar.xz</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIZE: 14709096
SHA1: 92b603c2a69fb25d66c337a63e94280984edea11
SHA256: 1a0e0b69b9b062b6299ff1f6c6d77b66aff3995f63d1d8b8771e7a113ec472e2
SHA512: a2bb6b5e62d5fa06dd9c30cf84ddcb2c27cb87fbaaffd2309a44391a6b110e1dde6b7b0d8c659b56387ee3c9b4264003f3532d5a374123a7c187ebba9293f320
</code></pre></div></div>
</li>
<li>
<p><a href="https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0.zip">https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0.zip</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIZE: 24388179
SHA1: e37435956d6f840a0e8758d7374bc7e0e346105f
SHA256: a3bfcd486d09c065d46421da0ff3d430ce4423fefd80cea63c6595d83ae4af0e
SHA512: 67db71144e06da2c1c25eaf413d1417c99a4b18738a573f9e3371c11ea242eee9dcbdc3de17336f25ab5060039fe034e57298943d344be9cd9eb33bb56e2e1c6
</code></pre></div></div>
</li>
</ul>
<h2>Ruby とは</h2>
<p>Rubyはまつもとゆきひろ (Matz) によって1993年に開発が始められ、今もオープンソースソフトウェアとして開発が続けられています。Rubyは様々なプラットフォームで動き、世界中で、特にWebアプリケーション開発のために使われています。</p>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>最近のニュース</strong></h3>

      <ul class="menu">
        
        <li><a href="/ja/news/2022/12/25/ruby-3-2-0-released/">Ruby 3.2.0 リリース</a></li>
        
        <li><a href="/ja/news/2022/12/06/ruby-3-2-0-rc1-released/">Ruby 3.2.0 RC 1 リリース</a></li>
        
        <li><a href="/ja/news/2022/11/24/ruby-3-1-3-released/">Ruby 3.1.3 リリース</a></li>
        
        <li><a href="/ja/news/2022/11/24/ruby-3-0-5-released/">Ruby 3.0.5 リリース</a></li>
        
        <li><a href="/ja/news/2022/11/24/ruby-2-7-7-released/">Ruby 2.7.7 リリース</a></li>
        
      </ul>
    </div>

    

    <h3>Syndicate</h3>
    <p><a href="/ja/feeds/news.rss">最近のニュース (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/ja/" class="home">Home</a>

  <a href="/ja/downloads/">ダウンロード</a>

  <a href="/ja/documentation/">ドキュメント</a>

  <a href="/ja/libraries/">ライブラリ</a>

  <a href="/ja/community/">コミュニティ</a>

  <a href="/ja/dev/">コア開発</a>

  <a href="/ja/news/">ニュース</a>

  <a href="/ja/security/">セキュリティ</a>

  <a href="/ja/about/">Rubyとは</a>


        </div>

        <p>

  This site in other languages:

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p><a href="/ja/about/website/">このウェブサイト</a>は Ruby コミュニティのメンバーによって運営されています。</p>


      </div>
    </div>
  </body>
</html>
