<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Denial of service attack was found for Ruby's Hash algorithm (CVE-2011-4815)</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/en/news/2011/12/28/denial-of-service-attack-was-found-for-rubys-hash-algorithm-cve-2011-4815/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/en/feeds/news.rss" rel="alternate" title="Recent News (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/en/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="013598269713424429640:g5orptiw95w" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="Search" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Denial of service attack was found for Ruby's Hash algorithm (CVE-2011-4815)</h1>



  <div id="content">
    <p class="post-info">Posted by Urabe Shyouhei on 28 Dec 2011</p>

    <h4>Impact</h4>
<p>This is something related to computational complexity. Specially crafted
series of strings that intentionally collide their hash values each
other was found. With such sequences an attacker can issue a denial of
service attack by, for instance, giving them as POST parameters of HTTP
requests for your Rails application.</p>
<h4>Detailed description</h4>
<p>The situation is similar to the one found for Perl in 2003. In 1.8
series of Ruby, we use a deterministic hash function to hash a string.
Here the &quot;deterministic&quot; means no other bits of information than the
input string itself is involved to generate a hash value. So you can
precalculate a string's hash value beforehand. By collecting a series
of strings that have the identical hash value, an attacker can let ruby
process collide bins of hash tables (including <code>Hash</code> class instances).
Hash tables' amortized O(1) attribute depends on uniformity of
distribution of hash values. By giving such crafted input, an attacker
can let hash tables work much slower than expected (namely
O(n<!-- raw HTML omitted -->2<!-- raw HTML omitted -->) to construct a n-elements table this case).</p>
<h4>Affected versions</h4>
<ul>
<li>Ruby 1.8.7-p352 and all prior versions.</li>
</ul>
<p>All Ruby 1.9 series are not affected by this kind of attack. They do not
share hash implementations with Ruby 1.8 series.</p>
<h4>Solution</h4>
<p>Our solution is to scramble the string hash function by some
PRNG-generated random bits. By doing so a string's hashed value is no
longer deterministic. That is, a <code>String#hash</code> result is consistent only
for current process lifetime and will generate a different number for
the next boot. To break this situation an attacker must create a set of
strings which are robust to this kind of scrambling. This is believed to
be quite difficult.</p>
<p>Please upgrade to <a href="http://mla.n-z.jp/?ruby-talk=391606">ruby 1.8.7-p357</a>.</p>
<h4>Notes</h4>
<ul>
<li>
<p>Bear in mind that the solution <em>does</em> <em>not</em> <em>mean</em> our hash algorithm
is cryptographically secure. To put it simple, we fixed the hash table
but we didn't fix <code>String#hash</code> weakness. An attacker could still
exploit it once he / she got a pair of a string and its hash value
returned from <code>String#hash</code>. You <em>must</em> <em>not</em> disclose <code>String#hash</code>
outputs. If you need to do such things, consider using secure hash
algorithms instead. Some of them (such as SHA256) are provided in
Ruby's standard library.</p>
</li>
<li>
<p>For those who knows alternative hash algorithms inside our code base:
we do not support them (they are disabled by default). By choosing
them we consider you can read C, and you can understand what was wrong
with the default one. Make sure that your choice is safe at your own
risk.</p>
</li>
</ul>
<h4>Credit</h4>
<p>Credit to Alexander Klink
<a href="mailto:alexander.klink@nruns.com">alexander.klink@nruns.com</a> and Julian
Waelde
<a href="mailto:jwaelde@cdc.informatik.tu-darmstadt.de">jwaelde@cdc.informatik.tu-darmstadt.de</a>
for reporting this issue.</p>
<p><strong>EDIT</strong> some related links:</p>
<ul>
<li><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4815">CVE-2011-4815</a> is assigned to this issue.</li>
<li>oCERT.org published <a href="http://www.ocert.org/advisories/ocert-2011-003.html">an advisory</a> about it.</li>
<li>JRuby released <a href="http://jruby.org/2011/12/27/jruby-1-6-5-1">version 1.6.5.1</a> to fix the identical issue. Other
ruby alternatives might also suffer.</li>
<li>Twitter account <a href="https://twitter.com/#!/hashDoS">@hashDoS</a> collects informations about hash
colliision attacks.</li>
</ul>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>Recent News</strong></h3>

      <ul class="menu">
        
        <li><a href="/en/news/2022/12/25/ruby-3-2-0-released/">Ruby 3.2.0 Released</a></li>
        
        <li><a href="/en/news/2022/12/06/ruby-3-2-0-rc1-released/">Ruby 3.2.0 RC 1 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-1-3-released/">Ruby 3.1.3 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-0-5-released/">Ruby 3.0.5 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-2-7-7-released/">Ruby 2.7.7 Released</a></li>
        
      </ul>
    </div>

    

    <h3>Syndicate</h3>
    <p><a href="/en/feeds/news.rss">Recent News (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


        </div>

        <p>

  This site in other languages:

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p><a href="/en/about/website/">This website</a> is proudly maintained by members of the Ruby community.</p>


      </div>
    </div>
  </body>
</html>
