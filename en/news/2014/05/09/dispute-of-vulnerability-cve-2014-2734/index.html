<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Dispute of Vulnerability CVE-2014-2734</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/en/news/2014/05/09/dispute-of-vulnerability-cve-2014-2734/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/en/feeds/news.rss" rel="alternate" title="Recent News (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/en/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="013598269713424429640:g5orptiw95w" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="Search" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Dispute of Vulnerability CVE-2014-2734</h1>



  <div id="content">
    <p class="post-info">Posted by emboss on 9 May 2014</p>

    <p>We were recently informed about a possible security vulnerability that has
been published as
<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-2734">CVE-2014-2734</a>.
However, based on our detailed analysis below, we do <strong>not</strong> consider Ruby
to be vulnerable.</p>
<p>This vulnerability could possibly allow an attacker to forge arbitrary root
certificates by modifying the certificate’s signature, effectively replacing
the certificate’s original private key with one chosen by the attacker.</p>
<h2>Proof of Concept</h2>
<p>The following is our analysis of CVE-2014-2734, we were able to reduce the
original PoC, which we believe captures the essence of the proof of concept:</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->forge_key<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->OpenSSL<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->PKey<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->RSA<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->2048<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted -->
<!-- raw HTML omitted -->raw_certificate<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->File<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->read<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;arbitrary.cer&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted -->
<!-- raw HTML omitted -->cert<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->OpenSSL<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->X509<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->Certificate<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->raw_certificate<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted -->
<!-- raw HTML omitted -->resigned_cert<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->cert<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->sign<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->spoof<!-- raw HTML omitted --><!-- raw HTML omitted -->,<!-- raw HTML omitted --> <!-- raw HTML omitted -->OpenSSL<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->Digest<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->SHA1<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->resigned_cert<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->verify<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->key<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted --> <!-- raw HTML omitted -->#=&gt; true<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>It may come as a surprise that <code>X509Certificate#verify</code> returns <code>true</code>.
The original certificate may contain a
<a href="http://tools.ietf.org/html/rfc5280#section-4.1.2.7">Subject Public Key Info</a>
pointing to the original public key which is different from the public key of
<code>forge_key</code>.  Clearly, the public / private key pair that was used to re-sign
the certificate no longer matches the original public key referenced in the
Subject Public Key Info. Why does <code>#verify</code> return <code>true</code>?</p>
<h3>How keys are verified</h3>
<p><code>X509Certificate#verify</code> uses OpenSSL’s
<a href="https://github.com/openssl/openssl/blob/master/crypto/x509/x_all.c#L74"><code>X509_verify</code></a>
function internally, which delegates to
<a href="https://github.com/openssl/openssl/blob/master/crypto/asn1/a_verify.c#L134"><code>ASN1_item_verify</code></a>.
These functions establish the validity of the signature given the public key
that was presented. However, they will <strong>not</strong> verify if the given key
actually matches any subject public key referenced in the certificate.
This means that returning <code>true</code> is expected behavior for <code>X509Certificate#verify</code>
in this scenario. Omitting this check has no significant impact on the overall
security of the X.509 trust model.</p>
<p>Section 4.1.1.3 of RFC 5280 explicitly states that by computing a
certificate’s signature, the CA confirms the correctness of the information
contained in the certificate. While this principle is violated in the above
example code, it poses no threat to security. A certificate forged or modified
in this way cannot be exploited unless someone is able to convince you to
explicitly trust a certificate that violates this principle.</p>
<h2>Potential risks</h2>
<p>There are two cases to consider:</p>
<h3>Re-signing a root certificate</h3>
<p>As users, we trust root certificates unconditionally. Even if they do not
contain valid information, the status of being a publicly acknowledged root
certificate alone is what keeps them pristine. They are preconfigured values
in the trust stores of our browsers or operating systems. Simply possessing
them establishes their status as valid trust anchors. For example, OpenSSL
itself does not check the signature of self-signed root certificates by
default for the same reasons,
cf. <a href="https://www.openssl.org/docs/crypto/X509_VERIFY_PARAM_set_flags.html">X509_V_FLAG_CHECK_SS_SIGNATURE documentation</a>.</p>
<p>A re-signed root certificate becomes a de facto “self-signed” certificate
(albeit with incorrect Subject Public Key Info). This is not any more
dangerous than a normal self-signed root certificate. In fact, anyone can
produce self-signed root certificates which may completely match that of a
valid root certificate - except for the signature. Since we trust root
certificates merely by possession, such an imposter certificate is meaningless
without a client’s active consent to trust it.</p>
<h3>Re-signing an intermediate or leaf certificate</h3>
<p>Also, re-signing a non-root certificate does not violate the security of the
X.509 trust model. While we usually do not possess these kinds of certificates
in advance, their forgery would be detected during the
<a href="http://tools.ietf.org/html/rfc5280#section-6">path validation procedure</a>.
Here, any non-root certificate’s signature is verified using the public key
of the issuing certificate. At some point in the certificate chain, the forgery
would be ultimately detected in the form of an invalid certificate signature
value.</p>
<h2>Conclusion</h2>
<p>In conclusion, we believe that <code>X509Certificate#verify</code> operates as expected.
Others have independently arrived at the
<a href="https://github.com/adrienthebo/cve-2014-2734/">same conclusion</a>
and we have therefore disputed CVE-2014-2734, and asked for its revocation.
You can find our complete analysis of the
<a href="https://gist.github.com/emboss/91696b56cd227c8a0c13">original proof of concept</a>
including comments.</p>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>Recent News</strong></h3>

      <ul class="menu">
        
        <li><a href="/en/news/2022/12/25/ruby-3-2-0-released/">Ruby 3.2.0 Released</a></li>
        
        <li><a href="/en/news/2022/12/06/ruby-3-2-0-rc1-released/">Ruby 3.2.0 RC 1 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-1-3-released/">Ruby 3.1.3 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-0-5-released/">Ruby 3.0.5 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-2-7-7-released/">Ruby 2.7.7 Released</a></li>
        
      </ul>
    </div>

    

    <h3>Syndicate</h3>
    <p><a href="/en/feeds/news.rss">Recent News (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


        </div>

        <p>

  This site in other languages:

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p><a href="/en/about/website/">This website</a> is proudly maintained by members of the Ruby community.</p>


      </div>
    </div>
  </body>
</html>
