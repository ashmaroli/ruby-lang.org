<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Security Fix for Ruby OpenSSL module: Allow "0/n splitting" as a prevention for the TLS BEAST attack.</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/en/news/2012/02/16/security-fix-for-ruby-openssl-module/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/en/feeds/news.rss" rel="alternate" title="Recent News (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/en/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="013598269713424429640:g5orptiw95w" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="Search" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Security Fix for Ruby OpenSSL module: Allow "0/n splitting" as a prevention for the TLS BEAST attack.</h1>



  <div id="content">
    <p class="post-info">Posted by Urabe Shyouhei on 16 Feb 2012</p>

    <p>In OpenSSL, <code>SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</code> option for SSL
connection is used to prevent TLS-CBC-IV vulnerability described at
<a href="http://www.openssl.org/~bodo/tls-cbc.txt">[1]</a>. It's known issue of TLSv1/SSLv3 but it attracts lots of
attention these days as BEAST attack <a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2011-3389">[2]</a> (CVE-2011-3389). Ruby
related topics are at our issue tracker <a href="https://bugs.ruby-lang.org/5353">[3]</a>.</p>
<p>Until now Ruby OpenSSL extension uses <code>SSL_OP_ALL</code> option, the combined
option of OpenSSL for various bug workarounds that should be rather
harmless, for all SSL connection by default. And it only allows users to
add other options so you could not remove the feature that is included
in <code>SSL_OP_ALL</code> option, like <code>SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</code>. It
was intentional as it didn't expose constants like
<code>SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</code>, but we should allow to unset the
option so that Ruby OpenSSL extension inserts empty fragments at the
beginning of SSL connections (named &quot;0/n splitting&quot;) to prevent the
TLS BEAST attack.</p>
<p><a href="http://mla.n-z.jp/?ruby-talk=393484">This release</a> defines additional constants and allows users to unset
options in <code>SSL_OP_ALL</code>. Default option is still <code>SSL_OP_ALL</code> but you
can setup the SSLSocket with doing &quot;0/n splitting&quot; for BEAST
prevention like this.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctx = SSLContext.new
ctx.options = OP_ALL &amp; ~OP_DONT_INSERT_EMPTY_FRAGMENTS
ctx.verify_mode = OpenSSL::SSL::VERIFY_PEER
SSLSocket.new(socket, ctx)
</code></pre></div></div>
<p>Credit to Apple for reporting this issue.</p>
<p>NOTE: Some SSL endpoints are known to have a bug that cannot handle
&quot;0/n splitting&quot; correctly so we (and OpenSSL) do not set this as a
default option. Please test SSL connectivity before enabling this in
production environment. If the other endpoint you're connecting cannot
handle &quot;0/n splitting&quot;, you must use another workaround for preventing
the TLS BEAST attack, like enforcing ciphersuite to use RC4. For
details, please find discussions and resources around CVE-2011-3389.</p>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>Recent News</strong></h3>

      <ul class="menu">
        
        <li><a href="/en/news/2022/12/25/ruby-3-2-0-released/">Ruby 3.2.0 Released</a></li>
        
        <li><a href="/en/news/2022/12/06/ruby-3-2-0-rc1-released/">Ruby 3.2.0 RC 1 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-1-3-released/">Ruby 3.1.3 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-0-5-released/">Ruby 3.0.5 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-2-7-7-released/">Ruby 2.7.7 Released</a></li>
        
      </ul>
    </div>

    

    <h3>Syndicate</h3>
    <p><a href="/en/feeds/news.rss">Recent News (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


        </div>

        <p>

  This site in other languages:

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p><a href="/en/about/website/">This website</a> is proudly maintained by members of the Ruby community.</p>


      </div>
    </div>
  </body>
</html>
