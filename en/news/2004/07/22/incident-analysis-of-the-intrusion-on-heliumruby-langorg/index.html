<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Incident Analysis of the intrusion on helium.ruby-lang.org</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/en/news/2004/07/22/incident-analysis-of-the-intrusion-on-heliumruby-langorg/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/en/feeds/news.rss" rel="alternate" title="Recent News (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/en/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="013598269713424429640:g5orptiw95w" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="Search" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Incident Analysis of the intrusion on helium.ruby-lang.org</h1>



  <div id="content">
    <p class="post-info">Posted by Shugo Maeda on 22 Jul 2004</p>

    <p>As already reported, helium.ruby-lang.org, which is one of the servers
that provided various services relevant to Ruby development, was cracked
by an unauthorized user.  We, the ruby-lang.org administrators, are
reporting our analysis of this intrusion and the countermeasures we've
taken.</p>
<h2>Time-line of the incident</h2>
<p>The time progression about the intrusion is shown below.
Each time is in UTC.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>19 May       The public disclosure of a vulnerability of CVS
             (CAN-2004-0396) is announced.  We believe that this
             vulnerability was used in this intrusion.
20 May 02:46 The Debian CVS package of the host helium.ruby-lang.org
             (hereafter called 'helium') is upgraded. However, the
             chrooted CVS package, which provided the actual pserver,
             is overlooked.
23 May 11:15 Oldest (corroborated) time stamp of the trace of intrusion
27 May 19:03 Opening of the back-door installed by the invader
28 May 09:26 A ruby-lang.org administrator discovers a trace of the
             intrusion.
28 May 09:35 Administrator disconnects 'helium' from network.
28 May 11:53 Administrator reboots 'helium' and resumes mailing list
             services.
29 May 07:28 Our first announcement about this intrusion.
</code></pre></div></div>
<h2>Machines and services of the time</h2>
<p>Ruby-related services were offered by the following two machines at the
time of intrusion.</p>
<p>helium.ruby-lang.org
: The following services were provided by 'helium'.</p>
<ul>
<li>CVS   (cvs.ruby-lang.org)</li>
<li>HTTP  (www.ruby-lang.org/raa.ruby-lang.org)</li>
<li>FTP   (ftp.ruby-lang.org)</li>
<li>RSYNC (for mirror sites)</li>
<li>ML    (&lt;ML name&gt;@ruby-lang.org)</li>
</ul>
<p>hydrogen.ruby-lang.org (hereafter called 'hydrogen')
: The following services were provided by 'hydrogen'.</p>
<ul>
<li>HTTP (www.rubyist.net)</li>
<li>NFS  (to export /home to 'helium')</li>
</ul>
<h2>Details of intrusion</h2>
<p>On 'helium', the pserver service was offered under anoncvs user
permissions in a chroot environment.  This CVS service was used for
development of Ruby, and multiple committers had their own accounts.
Public read-only CVS access was allowed via the 'anonymous' user
account.</p>
<p>As mentioned above, the vulnerability of CVS was announced on 19 May.
Although the Debian CVS package of 'helium' was upgraded on 20 May, the
CVS package of the chroot environment was not upgraded.</p>
<p>Under these circumstances, an administrator of 'helium' discovered
dubious processes of anoncvs on 28 May, 09:26 (UTC).  More than one
suspicious, executable files were discovered to have been installed  by
intruder(s), including a program creating a back-door listening on TCP
port #54320.  This back-door program was running at the time of the
discovery of the intrusion.  The &quot;Time-line&quot; time mentioned above was
determined by the output of the 'ps' command, and by the time stamp of
the intrusive executable file.  We should note here that all external
connections to the back-door were prevented by the Linux kernel's IP
packet filtering feature.</p>
<p>Another note: usually, the pserver process creates a temporary directory
(/tmp/cvs-serv&lt;Process ID&gt;) for each session and deletes it at the end
of the session.  At the time of the intrusion, more than one temporary
directories were left in the /tmp directory of the chroot environment.
This suggests that pserver processes were terminated abnormally, perhaps
by the attack of the intruder(s).  Of the time stamps of these temporary
directories, the oldest is of 23 May, 11:15 (UTC).  The &quot;Time-line&quot; time
mentioned above was determined by this time stamp.  Comparing time
stamps of these directories with the pserver session log, it appears
that there were multiple, independent crackers who attacked the
vulnerability.</p>
<p>This evidence indicates that intruder(s) were exploiting the CVS
vulnerability and received anoncvs user permission on 'helium'.
Intruder(s) could acquire, alter and destroy all information within the
chroot environment.</p>
<p>Evidence such as the seizing of other accounts, local privilege
escalation, or intrusion to outside of the chroot environment has, to
date, not been found.</p>
<h2>The possibility of intrusion outside of the chroot environment</h2>
<p>In order for intruders to break chroot protection, promotion to a
privilege user is required.</p>
<p>At the time of the intrusion, the Linux kernel running on 'helium' was
version 2.4.24.  The patch for the vulnerability (backported from kernel
version 2.4.25) had been applied.  However, the patch for setsockopt(2)
vulnerability fixed in kernel 2.4.26 had not been applied.</p>
<p>Code for a DoS attack exploiting a vulnerable setsockopt(2) has been
exhibited, but it is considered difficult to successfully achieve a
local privilege escalation from this.  It appears to be impossible to
achieve privilege escalation if the intruder is unable to get the kernel
image of the target environment.  On 'helium', the kernel was not from a
binary package, but was built from source code with individually applied
patches.  Therefore, the possibility that the intruder was able to
achieve privilege promotion is considered minimal.</p>
<h2>Restoration of services</h2>
<p>With the first investigation, we inferred that the intrusion was
probably only within the chroot environment.  At first we decided to
resume the mailing list service on 'helium', because the impact of a
suspension of mail service, from the users' point of view, was
considered the largest.  After checking that there was no alteration of
the binary package, and also that there was no suspicious settings in
the configuration files, we restored the mailing list service.</p>
<p>We then began the confirmation work for resuming other services on
'helium', but soon decided instead to thoroughly reconstruct the machine
and resume services individually after each was checked.  This decision
was made because of the difficulty of inspecting the large number of
files.</p>
<p>To restore the service, we needed a machine used as substitute for
'helium'.  We decided to use 'hydrogen' which hosted www.rubyist.net.
'Hydrogen' did not offer pserver service and no trace of intrusion was
found on the machine, but 'hydrogen' provided /home as NFS-mounted
filesystem to 'helium'.  To ensure that hydrogen was not compromised, we
re-installed the OS of 'hydrogen', and set the host name to 'lithium'.
Then we moved the mailing list service from 'helium' to 'lithium',
together with the intrusion announcement page of the web site.</p>
<p>Next, we re-installed OS of 'helium', and set the host name to
'beryllium'.  We plan to migrate all public services to 'beryllium' in
the future.</p>
<h2>Machines and services at present</h2>
<p>At present, Ruby-related services are offered by the following two
machines.</p>
<p>lithium.ruby-lang.org
: The following services are provided by lithium.ruby-lang.org.</p>
<ul>
<li>CVS (for committers development, no public access)</li>
<li>Mailing list (the move to 'beryllium' is planned)</li>
</ul>
<p>beryllium.ruby-lang.org
: The following services are provided by beryllium.ruby-lang.org.</p>
<ul>
<li>HTTP (www.ruby-lang.org/raa.ruby-lang.org/www.rubyist.net)</li>
<li>FTP (ftp.ruby-lang.org)</li>
<li>Anonymous CVS (cvs.ruby-lang.org)</li>
</ul>
<h2>Verification of the contents of each service</h2>
<p>We will hereafter explain the results of our efforts to evaluate
whether there was any alteration or destruction of services
by the intruders.</p>
<h3>Precondition</h3>
<p>The oldest evidence that we have of the intrusion is from 23 May, and
this has been corroborated; since this trace could have been deleted by
the intruder(s) with anoncvs user permission, we were not able to
conclude that this was the first day of the intrusion.  Since the
evidence of the intrusion was from the CVS vulnerability, and since no
other vulnerability which could have been exploited for intrusion into
'helium' is known, we are confident that the intruder(s) abused the CVS
vulnerability and thereby gained access to 'helium'.</p>
<p>Our verification of alteration or destruction in the services was based
on the assumption that the first intrusion would prove to be after 19
May, when the CVS vulnerability CAN-2004-0396 was publicly announced.</p>
<h3>CVS</h3>
<p>Since the intruders are supposed to have gained anoncvs user
permissions, we were most suspicious and anxious about possible damage
to CVS among all of the services on 'helium'.</p>
<p>At the time of intrusion, there was the following four CVS repositories.</p>
<p>/src
: Source code</p>
<p>/www
: Data of WWW</p>
<p>/doc
: Document</p>
<p>/admin
: The management file for CVS</p>
<p>Among these, /www and /doc needed no verification, since their contents
were already unused.  Moreover, we decided to suspend use of /admin, and
simply dropped it.</p>
<p>What we explain hereafter are the results of verification of the
source code of Ruby and of each other module included in /src.</p>
<h3>The source code of Ruby</h3>
<p>We split possible CVS repository alternations into two categories:</p>
<p>(1) Alteration of historical data in files in the CVS repository prior
to 19 May</p>
<p>(2) Alteration which camouflaged the regular submissions after 19 May</p>
<p>For (1), we checked files in the CVS repository by the log of cvsup
after 19 May which were kept securely outside of 'helium'.  We verified
that there has been no sign of alteration of files in the CVS
repository.  For (2), we checked all contents of the commits
individually and confirmed the absence of any malicious code after 19
May.  This means that not only is there no malicious code, but also that
we verified each commit with the committer.</p>
<p>Our verification was supported by data in the following URL.</p>
<ul>
<li>Log of cvsup<!-- raw HTML omitted -->
https://www.ruby-lang.org/check-data/cvs/cvsup-log/</li>
<li>Contents of the commits from 19 May to 28 May<!-- raw HTML omitted -->
https://www.ruby-lang.org/check-data/cvs/cvs-diff/</li>
</ul>
<p>Moreover, in addition to the above-mentioned material, we did the
following supplemental work:</p>
<ul>
<li>We confirmed there was no inconsistency between files in the CVS
repository on 'helium' and files in an exterior, secure server on 21
May.</li>
<li>We confirmed there was no inconsistency within the CVS snapshots
from 2003-11-02 to 2004-05-27 (day by day) and snapshots created from
the CVS repository on 'helium'.</li>
</ul>
<p>We concluded that there was no alteration or destruction of the source
code of ruby in the CVS repository.</p>
<h4>Modules other than the source code of Ruby</h4>
<p>In addition to the source code of Ruby, the /src directory of the CVS
repository has the following modules:</p>
<ul>
<li>app</li>
<li>lib</li>
<li>rough</li>
<li>rubicon</li>
<li>ruby-parser</li>
<li>shim</li>
<li>vms</li>
<li>pocketruby</li>
<li>oniguruma</li>
<li>mod_ruby</li>
<li>eruby</li>
</ul>
<p>First, we found that only the following files were changed after 19 May
by comparing the ctime of the files of the repository with the times of
the files copied to the external server by CVSup:</p>
<ul>
<li>lib/csv/lib/csv.rb,v</li>
<li>lib/csv/tests/csv_ut.rb,v</li>
<li>lib/soap4r/lib/wsdl/xmlSchema/parser.rb,v</li>
<li>lib/soap4r/lib/wsdl/xmlSchema/complexContent.rb,v</li>
<li>lib/soap4r/lib/wsdl/parser.rb,v</li>
<li>mod_ruby/lib/apache/eruby-run.rb,v</li>
<li>mod_ruby/lib/apache/erb-run.rb,v</li>
<li>mod_ruby/ChangeLog,v</li>
</ul>
<p>Second, we compared the copied CVS repository with the CVS repository on
'helium', and we confirmed that there was no inconsistency among them,
except for binary files in 'pocketruby'.  Since we had already merged
'wince' in ruby's main branch, we did not do further check on pocketruby
and have ceased offering its source code.</p>
<p>Each of the files which were changed after 19 May are mentioned below.</p>
<p>lib/csv/lib/csv.rb,v
lib/csv/tests/csv_ut.rb,v
lib/soap4r/lib/wsdl/xmlSchema/parser.rb,v
lib/soap4r/lib/wsdl/xmlSchema/complexContent.rb,v
lib/soap4r/lib/wsdl/parser.rb,v
: We are unsure about these files. lib/csv and lib/soap4r are already
merged with ruby, and these modules are only used by the maintainers
of each.  lib/csv and lib/soap4r have been removed from the CVS
repository, and will be developed elsewhere.</p>
<p>mod_ruby/lib/apache/eruby-run.rb,v
mod_ruby/lib/apache/erb-run.rb,v
: All revisions including branches had been checked, and no problems
were found. They were each compared with the released source
packages, and it has been confirmed that there are no
inconsistencies.</p>
<p>mod_ruby/ChangeLog,v
: Usual changes of a ChangeLog file are additions of the content(s).
The ChangeLog can be checked with the following methods:</p>
<p>(1) We confirmed that there is no problem in the first revision.</p>
<p>(2) We confirmed that there is no problem in the newest revision.</p>
<p>(3) We confirmed all revisions which include changes, not only
additions.</p>
<p>Moreover, we compared it with the released source packages, and it
has been verified that there are no inconsistencies.</p>
<p>In addition, the development of mod_ruby and eruby has moved to
Subversion, so those CVS module names have been changed to mod_ruby-old
and eruby-old.</p>
<h3>HTTP (www.ruby-lang.org)</h3>
<p>https://www.ruby-lang.org/{ja, en}/ is generated by tDiary.  We performed
the following in order to check that there are no problems executing the
tDiary CGI program:</p>
<ul>
<li>Confirmation of the absence of suspicious code in the CGI programs</li>
<li>Verification of code in <code>&lt;script&gt;</code> elements embedded in the contents</li>
<li>Confirmation of the absence of suspicious data in the configuration files</li>
</ul>
<p>Moreover, we checked the contents and linked URLs, but no problem is
found. If any problems are found, please contact to
webmaster@ruby-lang.org.</p>
<h3>On-line reference manual</h3>
<p>On-line reference manual was on RWiki. We first restored the contents on
29 Feb, then applied the patches mailed to external e-mail accounts on
29 Feb. Then we compared it with the contents on 'helium'.</p>
<p>The diff can be obtained from:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.ruby-lang.org/check-data/ruby-man/man-rd-ja.diff
</code></pre></div></div>
<p>The difference of Base64.rd comes from new-lines inserted when receiving
the mail. trap%3A%3ANilClass.rd.rej was rejected, because the same patch
applied twice. The diff script compared files with files from 61 minutes
prior, so the same patch sent twice.</p>
<p>We confirmed none of them were affected by the intrusion.</p>
<h3>RAA</h3>
<p>We did the following data verification.</p>
<ul>
<li>
<p>We made a daily diff of RAA data from 1) the clean RAA data copy
backed up on 27 Mar, 2) daily backups from 4 Apr to 28 May, and 3) the
latest RAA data of 28 May.</p>
<ol start="2">
<li>and 3) are located in a chroot protected area on the machine.</li>
<li>is clean because it is kept in a development environment.</li>
</ol>
<ul>
<li>RAA data update:<!-- raw HTML omitted -->
http://raa.ruby-lang.org/announce/soapbox-diff-all-passphrasemask.txt</li>
<li>RAA new entry:<!-- raw HTML omitted -->
http://raa.ruby-lang.org/announce/soapbox-new-passphrasemask.txt</li>
</ul>
</li>
<li>
<p>We confirmed the absence of suspicious data in the above diffs.</p>
</li>
</ul>
<p>It can be concluded that the RAA data of 28 May (the same data we use
for RAA service restart) does not include any suspicious data.
We therefore decided to restart the RAA service as it was on 28 May.  We
cannot offer assurances that normal-looking changes by the intruder do not
exist.  For example, the change of sampleproject on 18 May is as
follows;</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>== sampleproject
- updated: Sun May 09 12:35:19 GMT+9:00 2004
+ updated: Mon May 17 13:00:38 GMT+9:00 2004
- version: 0.0.8
+ version: 0.1.1
</code></pre></div></div>
<p>None of this data is suspect, but it is possible that the changes were
made by the intruder.  Therefore, we request that each RAA project owner
CHECK THEIR RAA ENTRIES AND UPDATE THEM FOR CONFIRMATION.  To do this,
take the following steps:</p>
<p>(1) Open the project page</p>
<p>(2) Check the project information</p>
<p>(3) Go to the &quot;update&quot; page</p>
<p>(4) Press the &quot;submit&quot; button (do this even if no update is needed --
this step is for confirmation)</p>
<p>Please contact raa-admin@ruby-lang.org if you find any suspicious data
in RAA, or you have any question. Thank you for your cooperation.</p>
<h3>FTP</h3>
<p>We compared md5sum values of files on FTP with the files kept in the
exterior, secure server, and there were no differences.</p>
<p>However, we could not check the following directories.  Consequently,
they are not currently provided.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/pub/ruby/contrib/
/pub/ruby/doc/
/pub/ruby/snapshots/
/pub/ruby/ML/
/pub/ruby/shim/
</code></pre></div></div>
<p>If you need files in these directories, please contact
ftpadmin@ruby-lang.org.</p>
<h3>Mailing list</h3>
<p>We investigated the configuration files of each mailing list, and found
no issues. However, member lists and mail archives have not been
thoroughly checked.</p>
<p>If you have any problems, please contact to &lt;ML name&gt;-admin@ruby-lang.org.</p>
<p>Shugo Maeda &lt;shugo@ruby-lang.org&gt;<!-- raw HTML omitted -->
ruby-lang.org administrators' group</p>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>Recent News</strong></h3>

      <ul class="menu">
        
        <li><a href="/en/news/2022/12/25/ruby-3-2-0-released/">Ruby 3.2.0 Released</a></li>
        
        <li><a href="/en/news/2022/12/06/ruby-3-2-0-rc1-released/">Ruby 3.2.0 RC 1 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-1-3-released/">Ruby 3.1.3 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-0-5-released/">Ruby 3.0.5 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-2-7-7-released/">Ruby 2.7.7 Released</a></li>
        
      </ul>
    </div>

    

    <h3>Syndicate</h3>
    <p><a href="/en/feeds/news.rss">Recent News (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


        </div>

        <p>

  This site in other languages:

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p><a href="/en/about/website/">This website</a> is proudly maintained by members of the Ruby community.</p>


      </div>
    </div>
  </body>
</html>
