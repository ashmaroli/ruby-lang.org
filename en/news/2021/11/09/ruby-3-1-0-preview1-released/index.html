<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Ruby 3.1.0 Preview 1 Released</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/en/news/2021/11/09/ruby-3-1-0-preview1-released/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/en/feeds/news.rss" rel="alternate" title="Recent News (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/en/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/en/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="013598269713424429640:g5orptiw95w" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="Search" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Ruby 3.1.0 Preview 1 Released</h1>



  <div id="content">
    <p class="post-info">Posted by naruse on 9 Nov 2021</p>

    <p>We are pleased to announce the release of Ruby 3.1.0-preview1.</p>
<h2>YJIT: New experimental in-process JIT compiler</h2>
<p>Ruby 3.1 merges YJIT, a new in-process JIT compiler developed by Shopify.</p>
<p>Since <a href="https://www.ruby-lang.org/en/news/2018/12/25/ruby-2-6-0-released/">Ruby 2.6 introduced MJIT in 2018</a>, its performance greatly improved, and finally <a href="https://www.ruby-lang.org/en/news/2020/12/25/ruby-3-0-0-released/">we achieved Ruby3x3 last year</a>. But even though Optcarrot has shown impressive speedups, the JIT hasn't benefited real world business applications.</p>
<p>Recently Shopify contributed many Ruby improvements to speed up their Rails application. YJIT is an important contribution, and aims to improve the performance of Rails applications.</p>
<p>Though MJIT is a method-based JIT compiler and uses an external C compiler, YJIT uses Basic Block Versioning and includes JIT compiler inside it. With Lazy Basic Block Versioning (LBBV) it first compiles the beginning of a method, and incrementally compiles the rest when the type of arguments and variables are dynamically determined. See <a href="https://dl.acm.org/doi/10.1145/3486606.3486781">YJIT: a basic block versioning JIT compiler for CRuby</a> for a detailed introduction.</p>
<p>With this technology, YJIT achieves both fast warmup time and performance improvements on most real-world software, up to 22% on railsbench, 39% on liquid-render.</p>
<!-- raw HTML omitted -->
<p>YJIT is still an experimental feature, and as such, it is disabled by default. If you want to use this, specify the <code>--yjit</code> command-line option to enable YJIT. It is also limited to macOS &amp; Linux on x86-64 platforms for now.</p>
<ul>
<li><a href="https://bugs.ruby-lang.org/issues/18229">https://bugs.ruby-lang.org/issues/18229</a></li>
<li><a href="https://shopify.engineering/yjit-just-in-time-compiler-cruby">https://shopify.engineering/yjit-just-in-time-compiler-cruby</a></li>
<li><a href="https://www.youtube.com/watch?v=PBVLf3yfMs8">https://www.youtube.com/watch?v=PBVLf3yfMs8</a></li>
</ul>
<h2>debug gem: A new debugger</h2>
<p>A new debugger <a href="https://github.com/ruby/debug">debug.gem</a> is bundled. debug.gem is fast debugger implementation and it provides many features like remote debugging, colorful REPL, IDE (VSCode) integration and more. It replaces <code>lib/debug.rb</code> standard library.</p>
<h2>error_highlight: Fine-grained error location in backtrace</h2>
<p>A built-in gem, error_highlight, has been introduced. It includes fine-grained error location in backtrace:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ruby test.rb
test.rb:1:in `&lt;main&gt;': undefined method `time' for 1:Integer (NoMethodError)

1.time {}
 ^^^^^
Did you mean?  times
</code></pre></div></div>
<p>This gem is enabled by default. You can disable it by using a command-line option <code>--disable-error_highlight</code>. See <a href="https://github.com/ruby/error_highlight">the repository</a> in detail.</p>
<h2>Irb improvement</h2>
<p>To be described in next preview.</p>
<h2>Other Notable New Features</h2>
<h3>Language</h3>
<ul>
<li>
<p>Values in Hash literals and keyword arguments can be omitted. [Feature #14579]</p>
<ul>
<li><code>{x:, y:}</code> is a syntax sugar of <code>{x: x, y: y}</code>.</li>
<li><code>foo(x:, y:)</code> is a syntax sugar of <code>foo(x: x, y: y)</code>.</li>
</ul>
</li>
<li>
<p>Pin operator in pattern matching now takes an expression. [Feature #17411]</p>
</li>
</ul>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code data-lang="ruby"><span class="no">Prime</span><span class="p">.</span><span class="nf">each_cons</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">lazy</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="n">_1</span> <span class="k">in</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="o">^</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]}.</span><span class="nf">take</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">to_a</span>
<span class="c1">#=&gt; [[3, 5], [5, 7], [11, 13]]</span>
</code></pre></div></div>
<h3>RBS</h3>
<p>RBS is a language to describe the structure of Ruby programs. See <a href="https://github.com/ruby/rbs">the repository</a> for detail.</p>
<p>Updates since Ruby 3.0.0:</p>
<ul>
<li><code>rbs collection</code> has been introduced to manage gems' RBSs.  <a href="https://github.com/ruby/rbs/blob/master/docs/collection.md">doc</a></li>
<li>Many signatures for built-in and standard libraries have been added/updated.</li>
<li>It includes many bug fixes and performance improvements too.</li>
</ul>
<p>See <a href="https://github.com/ruby/rbs/blob/master/CHANGELOG.md">the CHANGELOG.md</a> for more information.</p>
<h3>TypeProf</h3>
<p>TypeProf is a static type analyzer for Ruby. It generates a prototype of RBS from non-type-annotated Ruby code. See <a href="https://github.com/ruby/typeprof/blob/master/doc/doc.md">the document</a> for detail.</p>
<p>Updates since Ruby 3.0.0:</p>
<ul>
<li><a href="https://github.com/ruby/typeprof/blob/master/doc/ide.md">Experimental IDE support</a> has been implemented.</li>
<li>Many bug fixes and performance improvements.</li>
</ul>
<h2>Performance improvements</h2>
<ul>
<li>MJIT
<ul>
<li>For workloads like Rails, the default <code>--jit-max-cache</code> is changed from 100 to 10000.
The JIT compiler no longer skips compilation of methods longer than 1000 instructions.</li>
<li>To support Zeitwerk of Rails, JIT-ed code is no longer cancelled
when a TracePoint for class events is enabled.</li>
</ul>
</li>
</ul>
<h2>Other notable changes since 3.0</h2>
<ul>
<li>One-line pattern matching, e.g., <code>ary =&gt; [x, y, z]</code>, is no longer experimental.</li>
<li>Multiple assignment evaluation order has been changed slightly. <a href="https://bugs.ruby-lang.org/issues/4443">[Bug #4443]</a>
<ul>
<li><code>foo[0], bar[0] = baz, qux</code> was evaluated in order <code>baz</code>, <code>qux</code>, <code>foo</code>, and then <code>bar</code> in Ruby 3.0. In Ruby 3.1, it is evaluated in order <code>foo</code>, <code>bar</code>, <code>baz</code>, and then <code>qux</code>.</li>
</ul>
</li>
<li>Variable Width Allocation: Strings (experimental) <a href="https://bugs.ruby-lang.org/issues/18239">[Bug #18239]</a></li>
</ul>
<h3>Standard libraries updates</h3>
<ul>
<li>Some standard libraries are updated.
<ul>
<li>RubyGems</li>
<li>Bundler</li>
<li>RDoc 6.4.0</li>
<li>ReLine</li>
<li>JSON 2.6.0</li>
<li>Psych 4.0.2</li>
<li>FileUtils 1.6.0</li>
<li>Fiddle</li>
<li>StringIO 3.0.1</li>
<li>IO::Console 0.5.9</li>
<li>IO::Wait 0.2.0</li>
<li>CSV</li>
<li>Etc 1.3.0</li>
<li>Date 3.2.0</li>
<li>Zlib 2.1.1</li>
<li>StringScanner</li>
<li>IpAddr</li>
<li>Logger 1.4.4</li>
<li>OStruct 0.5.0</li>
<li>Irb</li>
<li>Racc 1.6.0</li>
<li>Delegate 0.2.0</li>
<li>Benchmark 0.2.0</li>
<li>CGI 0.3.0</li>
<li>Readline(C-ext) 0.1.3</li>
<li>Timeout 0.2.0</li>
<li>YAML 0.2.0</li>
<li>URI 0.11.0</li>
<li>OpenSSL</li>
<li>DidYouMean</li>
<li>Weakref 0.1.1</li>
<li>Tempfile 0.1.2</li>
<li>TmpDir 0.1.2</li>
<li>English 0.7.1</li>
<li>Net::Protocol 0.1.2</li>
<li>Net::Http 0.2.0</li>
<li>BigDecimal</li>
<li>OptionParser 0.2.0</li>
<li>Set</li>
<li>Find 0.1.1</li>
<li>Rinda 0.1.1</li>
<li>Erb</li>
<li>NKF 0.1.1</li>
<li>Base64 0.1.1</li>
<li>OpenUri 0.2.0</li>
<li>SecureRandom 0.1.1</li>
<li>Resolv 0.2.1</li>
<li>Resolv::Replace 0.1.0</li>
<li>Time 0.2.0</li>
<li>PP 0.2.1</li>
<li>Prettyprint 0.1.1</li>
<li>Drb 2.1.0</li>
<li>Pathname 0.2.0</li>
<li>Digest 3.1.0.pre2</li>
<li>Un 0.2.0</li>
</ul>
</li>
<li>The following bundled gems are updated.
<ul>
<li>minitest 5.14.4</li>
<li>power_assert 2.0.1</li>
<li>rake 13.0.6</li>
<li>test-unit 3.5.0</li>
<li>rbs 1.6.2</li>
<li>typeprof 0.20.0</li>
</ul>
</li>
<li>The following default gems are now bundled gems.
<ul>
<li>net-ftp</li>
<li>net-imap</li>
<li>net-pop</li>
<li>net-smtp</li>
<li>matrix</li>
<li>prime</li>
</ul>
</li>
</ul>
<p>See <a href="https://github.com/ruby/ruby/blob/v3_1_0_preview1/NEWS.md">NEWS</a>
or <a href="https://github.com/ruby/ruby/compare/v3_0_0...v3_1_0_preview1">commit logs</a>
for more details.</p>
<p>With those changes, <a href="https://github.com/ruby/ruby/compare/v3_0_0...v3_1_0_preview1#file_bucket">2963 files changed, 529321 insertions(+), 92305 deletions(-)</a>
since Ruby 3.0.0!</p>
<h2>Download</h2>
<ul>
<li>
<p><a href="https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0-preview1.tar.gz">https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0-preview1.tar.gz</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIZE: 20821221
SHA1: 40dfd3db076a49fab9a0eee51e89d9b3d16a4e23
SHA256: 540f49f4c3aceb1a5d7fb0b8522a04dd96bc4a22f9660a6b59629886c8e010d4
SHA512: 63f528f20905827d03649ed9804e4a4e5c15078f9c6c8efcfb306baa7baafa17a406eb09a2c08b42e151e14af33b1aadbd9fb1cc84f9353d070b54bbf1ff950d
</code></pre></div></div>
</li>
<li>
<p><a href="https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0-preview1.tar.xz">https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0-preview1.tar.xz</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIZE: 15742844
SHA1: 22aa861b17031cd1b163b7443f5f2f5897c5895e
SHA256: 86a836ad42f6a7a469fce71ffec48fd3184af55bf79e488b568a4f64adee551d
SHA512: bdbd7c624197ca478658280d84123a8c12ae72425bc566dcc75989c5b5ef114dd57e64efc09e2413ed615d9b47621a70ace0f3612e8ca7ba853822ad9e88c0b0
</code></pre></div></div>
</li>
<li>
<p><a href="https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0-preview1.zip">https://cache.ruby-lang.org/pub/ruby/3.1/ruby-3.1.0-preview1.zip</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIZE: 25019629
SHA1: ef5fa22890e55935db4b96b3089a8aea1335bd85
SHA256: 4e8d118b2365164873148ac545a8fa36c098b846a9b19ebb9037f8ee9adb4414
SHA512: 917803aac0848e00871614a09740b5c9cca26f200d68580dde61666633f1b7fee506e25ea4ed0c38eb20149417bf9f1ed449a4d2aec5b726de670e7177e5c07a
</code></pre></div></div>
</li>
</ul>
<h2>What is Ruby</h2>
<p>Ruby was first developed by Matz (Yukihiro Matsumoto) in 1993,
and is now developed as Open Source. It runs on multiple platforms
and is used all over the world especially for web development.</p>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>Recent News</strong></h3>

      <ul class="menu">
        
        <li><a href="/en/news/2022/12/25/ruby-3-2-0-released/">Ruby 3.2.0 Released</a></li>
        
        <li><a href="/en/news/2022/12/06/ruby-3-2-0-rc1-released/">Ruby 3.2.0 RC 1 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-1-3-released/">Ruby 3.1.3 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-3-0-5-released/">Ruby 3.0.5 Released</a></li>
        
        <li><a href="/en/news/2022/11/24/ruby-2-7-7-released/">Ruby 2.7.7 Released</a></li>
        
      </ul>
    </div>

    

    <h3>Syndicate</h3>
    <p><a href="/en/feeds/news.rss">Recent News (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/en/" class="home">Home</a>

  <a href="/en/downloads/">Downloads</a>

  <a href="/en/documentation/">Documentation</a>

  <a href="/en/libraries/">Libraries</a>

  <a href="/en/community/">Community</a>

  <a href="/en/news/">News</a>

  <a href="/en/security/">Security</a>

  <a href="/en/about/">About Ruby</a>


        </div>

        <p>

  This site in other languages:

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p><a href="/en/about/website/">This website</a> is proudly maintained by members of the Ruby community.</p>


      </div>
    </div>
  </body>
</html>
