<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    
    <title>Objections sur la vulnérabilité CVE-2014-2734</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta itemprop="image" content="https://www.ruby-lang.org/images/header-ruby-logo@2x.png">
    
    <meta name="description" content="">
    

    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygments.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic&amp;subset=latin,cyrillic,greek,vietnamese' rel='stylesheet' type='text/css'>
    <link rel="canonical" href="https://www.ruby-lang.org/fr/news/2014/05/09/dispute-of-vulnerability-cve-2014-2734/">

    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link href="/fr/feeds/news.rss" rel="alternate" title="Actualité récente (RSS)" type="application/rss+xml">


    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/page.js"></script>
    
  </head>

  

  <body>
    <div id="header">
      <div id="header_content" class="container">
        <a href="/fr/">
          <h1>Ruby</h1>
          <h2>A Programmer's Best Friend</h2>
        </a>

        <div class="site-links">
          

  <a href="/fr/" class="home">Home</a>

  <a href="/fr/downloads/">Téléchargements</a>

  <a href="/fr/documentation/">Documentation</a>

  <a href="/fr/libraries/">Bibliothèques</a>

  <a href="/fr/community/">Communauté</a>

  <a href="/fr/news/">Actualités</a>

  <a href="/fr/security/">Sécurité</a>

  <a href="/fr/about/">À propos de Ruby</a>


          <a href="#" class="menu selected">Menu</a>
        </div>

        <div id="search-box">
          
<form id="search-form" action="https://www.google.com/cse">
  <table class="fieldset">
    <tr>
      <td>
        <input class="field" type="text" name="q" size="31" style="background: white url(//www.google.com/coop/intl/fr/images/google_custom_search_watermark.gif) left no-repeat" onfocus="this.style.background='white'" onblur="if (/^\s*$/.test(this.value)) this.style.background='white url(//www.google.com/coop/intl/fr/images/google_custom_search_watermark.gif) left no-repeat'"/>
      </td>
      <td>
        <input type="hidden" name="cx" value="016749562256550695330:efcmgh3a1ac" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input class="button" type="submit" name="sa" value="Recherche" />
      </td>
    </tr>
  </table>
</form>

        </div>
      </div>
    </div>

    <div id="page">
      


      <div id="main-wrapper" class="container">
        <div id="main">
          

<div id="content-wrapper">
  
<h1>Objections sur la vulnérabilité CVE-2014-2734</h1>



  <div id="content">
    <p class="post-info">Posté par emboss le 2014-05-09<br>
                         Traduit par Jean-Denis Vauguet</p>

    <p>Il a récemment été mis en lumière une vulnérabilité qui pourrait affecter
Ruby, en l'occurrence
<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-2734">CVE-2014-2734</a>.
Toutefois, sur la base d'une analyse détaillée retranscrite ci-dessous,
nous considérons que Ruby <strong>n'est pas</strong> concerné par cette faille de
sécurité.</p>
<p>Cette faille donne à un attaquant la possibilité de contrefaire n'importe
lequel des certificats racine, en modifiant sa signature (ce qui revient
dans les faits à remplacer la clé privée originelle du certificat par une
autre clé, choisie par l'attaquant).</p>
<h2>Démonstration du problème</h2>
<p>Ce qui suit est notre analyse de CVE-2014-2734. Nous avons été en mesure de
condenser notre prototype initial en quelques lignes qui démontrent le
cœur du problème :</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->forge_key<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->OpenSSL<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->PKey<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->RSA<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->2048<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted -->
<!-- raw HTML omitted -->raw_certificate<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->File<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->read<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;arbitrary.cer&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted -->
<!-- raw HTML omitted -->cert<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->OpenSSL<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->X509<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->Certificate<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->raw_certificate<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted -->
<!-- raw HTML omitted -->resigned_cert<!-- raw HTML omitted --> <!-- raw HTML omitted -->=<!-- raw HTML omitted --> <!-- raw HTML omitted -->cert<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->sign<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->spoof<!-- raw HTML omitted --><!-- raw HTML omitted -->,<!-- raw HTML omitted --> <!-- raw HTML omitted -->OpenSSL<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->Digest<!-- raw HTML omitted --><!-- raw HTML omitted -->::<!-- raw HTML omitted --><!-- raw HTML omitted -->SHA1<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->new<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->resigned_cert<!-- raw HTML omitted --><!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted -->verify<!-- raw HTML omitted --><!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted -->key<!-- raw HTML omitted --><!-- raw HTML omitted -->)<!-- raw HTML omitted --> <!-- raw HTML omitted -->#=&gt; true<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>Il peut effectivement sembler étrange que <code>X509Certificate#verify</code> soit évalué
à <code>true</code>. Le certificat original peut contenir des métadonnées de type
<a href="http://tools.ietf.org/html/rfc5280#section-4.1.2.7">Subject Public Key Info</a>
qui pointent vers la clé publique originelle, différente de la clé publique
<code>forge_key</code>. Manifestement, la paire de clés (publique/privée) utilisée pour
re-signer le certificat ne correspond plus à la clé publique originelle,
référencée dans le hash de métadonnées. Pourquoi, dans ces conditions, <code>#verify</code>
retournerait <code>true</code> ?</p>
<h3>À propos de la vérification des clés</h3>
<p><code>X509Certificate#verify</code> fait usage de la méthode
<a href="https://github.com/openssl/openssl/blob/master/crypto/x509/x_all.c#L74"><code>X509_verify</code></a>
d'OpenSSL, une fonction qui délègue en fait à
<a href="https://github.com/openssl/openssl/blob/master/crypto/asn1/a_verify.c#L134"><code>ASN1_item_verify</code></a>.
Ces fonctions vérifient la validité de la signature, étant donnée une clé
publique initiale. Cependant, elles ne vérifieront <strong>pas</strong> si la clé en
question correspond à une éventuelle clé publique référencée <em>dans</em> le
certificat. C'est pourquoi la valeur de retour <code>true</code> est bien le
comportement attendu pour <code>X509Certificate#verify</code>, dans ce cas précis.
Il faut bien comprendre que ne pas effectuer cette « double vérification » ne
remet en aucun cas en cause la sécurité du modèle de confiance X.509.</p>
<p>La section 4.1.1.3 de la RFC 5280 rend explicite le fait que, en calculant la
signature d'un certificat, la CA (<em>Certificate Authority</em>) confirme <em>de facto</em>
la validité des informations contenues dans le-dit certificat. Bien que ce
principe soit visiblement bafoué dans l'exemple ci-dessus, il n'implique en
fait aucune faille de sécurité, du fait de l'implémentation de la procédure. Un
certificat modifié de cette façon ne saurait être utilisé par un attaquant, à
moins que l'attaque ne soit effectivement en mesure de vous faire explicitement
admettre que le certificat est valide.</p>
<h2>Les risques potentiels</h2>
<p>Deux cas sont à considérer :</p>
<h3>Le fait de signer à nouveau un certificat racine</h3>
<p>En tant qu'utilisateurs de certificats, nous plaçons une confiance
inconditionnelle dans les certificats <em>racines</em>. Quand bien même ils ne
contiendraient pas des informations valides, le fait qu'ils aient été
approuvés publiquement par une autorité de certification les rend digne de
confiance. Ils agissent comment des valeurs pré-configurées dans nos
navigateurs ou nos systèmes d'exploitation : le simple fait de les posséder
leur donne le statut de référence. À ce titre, même OpenSSL ne prend pas la
peine de vérifier la signature de ses propres certificats racines, arguant du
fait qu'ils sont auto-signés (cf.
<a href="https://www.openssl.org/docs/crypto/X509_VERIFY_PARAM_set_flags.html">X509_V_FLAG_CHECK_SS_SIGNATURE documentation</a>).</p>
<p>À ce titre, un certificat racine re-signé est <em>immédiatement</em> considéré comme
digne de confiance, même dans le cas où il contiendrait des informations
erronées (Subject Public Key Info). Ce certificat étant racine, il n'y aucune
différence avec un certificat racine « valide », donc aucune raison de
procéder à une vérification. En principe, n'importe qui peut produire des
certificats racines auto-signés qui correspondent point pour point à un
certificat racine déjà existant, à l'exception bien sûr de la signature. On
comprend alors qu'en jouant sur le fait que nous faisons confiance aux
certificats racines que nous possédons, pour la simple raison que <em>nous les
possédons</em>, il devient possible à quelqu'un en capacité de produire un
vrai-faux certificat racine et de le mettre en place chez quelqu'un, de se
créer un vecteur d'attaque important.</p>
<h3>Le fait de re-signer un certificat intermédiaire</h3>
<p>Si le fait de re-signer un certificat racine ne représente pas une faille de
sécurité <em>en tant que telle</em> dans le modèle de confiance X.509, il en va de
même pour le fait de re-signer un certificat intermédiaire, mais pour une
raison tout à fait différente.</p>
<p>Nous ne possédons en général pas de certificats non-racine en avance. Une
contrefaçon sur ce type de certificat sera par conséquent détectée lors de la
procédure de validation
(<a href="http://tools.ietf.org/html/rfc5280#section-6">path validation procedure</a>). Il
s'agit ici de vérifier la signature de tout certificat non racine en utilisant
la clé publique du certificat d'autorité correspondant. Si le certificat non
racine en cours de vérification a été modifié, sa non conformité sera tout
simplement détectée sous la forme d'une signature non valide. Il s'agit du
modèle de confiance standard.</p>
<h2>Conclusion</h2>
<p>En résumé, nous sommes convaincus que <code>X509Certificate#verify</code> n'introduit pas
de faille de sécurité d'un point de vue technique. D'autres analyses
indépendantes sont arrivées à
<a href="https://github.com/adrienthebo/cve-2014-2734/">la même conclusion</a>, de sorte
que nous avons décidé de demander le retrait de CVE-2014-2734. Vous pouvez lire
l'analyse complète sur le
<a href="https://gist.github.com/emboss/91696b56cd227c8a0c13">prototype original</a>.</p>

  </div>
</div>
<hr class="hidden-modern" />

<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="navigation">
      

      <h3><strong>Actualité récente</strong></h3>

      <ul class="menu">
        
        <li><a href="/fr/news/2022/02/18/ruby-3-1-1-released/">Ruby 3.1.1 est disponible</a></li>
        
        <li><a href="/fr/news/2021/12/25/ruby-3-1-0-released/">Ruby 3.1.0 est disponible</a></li>
        
        <li><a href="/fr/news/2021/11/24/ruby-3-0-3-released/">Ruby 3.0.3 est disponible</a></li>
        
        <li><a href="/fr/news/2021/11/24/ruby-2-7-5-released/">Ruby 2.7.5 est disponible</a></li>
        
        <li><a href="/fr/news/2021/11/24/ruby-2-6-9-released/">Ruby 2.6.9 est disponible</a></li>
        
      </ul>
    </div>

    

    <h3>Syndication</h3>
    <p><a href="/fr/feeds/news.rss">Actualité récente (RSS)</a></p>
  </div>
</div>
<hr class="hidden-modern" />

        </div>
      </div>
    </div>

    <div class="container">
      <div id="footer">
        <div class="site-links">
          

  <a href="/fr/" class="home">Home</a>

  <a href="/fr/downloads/">Téléchargements</a>

  <a href="/fr/documentation/">Documentation</a>

  <a href="/fr/libraries/">Bibliothèques</a>

  <a href="/fr/community/">Communauté</a>

  <a href="/fr/news/">Actualités</a>

  <a href="/fr/security/">Sécurité</a>

  <a href="/fr/about/">À propos de Ruby</a>


        </div>

        <p>

  Autres langues disponibles :

<a href="/bg/">Български</a>,
<a href="/de/">Deutsch</a>,
<a href="/en/">English</a>,
<a href="/es/">Español</a>,
<a href="/fr/">Français</a>,
<a href="/id/">Bahasa Indonesia</a>,
<a href="/it/">Italiano</a>,
<a href="/ja/">日本語</a>,
<a href="/ko/">한국어</a>,
<a href="/pl/">polski</a>,
<a href="/pt/">Português</a>,
<a href="/ru/">Русский</a>,
<a href="/tr/">Türkçe</a>,
<a href="/vi/">Tiếng Việt</a>,
<a href="/zh_cn/">简体中文</a>,
<a href="/zh_tw/">繁體中文</a>.
</p>

        
  <p>Ce site est propulsé par Ruby et <a href="http://www.jekyllrb.com/">Jekyll</a>. Il est fièrement maintenu par des membres de la communauté Ruby. Contribuez en vous rendant sur <a href="https://github.com/ruby/www.ruby-lang.org/">GitHub</a> ou contactez le <a href="mailto:webmaster@ruby-lang.org">webmaster</a> pour toute question ou tout commentaire.</p>


      </div>
    </div>
  </body>
</html>
